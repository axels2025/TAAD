{% extends "base.html" %}

{% block title %}Add Manual Trade{% endblock %}

{% block content %}
<h2 style="margin-bottom: 15px; color: #333;">Enter Trade Details</h2>

<div style="background: #e3f2fd; padding: 12px 16px; border-radius: 6px; margin-bottom: 25px; border-left: 4px solid #2196f3;">
    <p style="margin: 0; color: #1565c0; font-size: 14px;">
        ðŸ’¡ <strong>IBKR Reference:</strong> Use "IV Last" for implied volatility (enter as decimal: 75% â†’ 0.75).
        "Implied Vol/Hist Vol" is a ratio - don't use that field.
    </p>
</div>

<form method="POST" action="{{ url_for('add_trade') }}">
    <!-- Required Fields -->
    <div class="form-row">
        <div class="form-group">
            <label>
                Symbol <span class="required">*</span>
            </label>
            <input type="text" name="symbol" required placeholder="AAPL" pattern="[A-Za-z]+"
                   style="text-transform: uppercase;">
            <div class="help-text">Stock ticker symbol</div>
        </div>

        <div class="form-group">
            <label>
                Strike Price <span class="required">*</span>
            </label>
            <input type="number" name="strike" required step="0.01" min="0" placeholder="180.00">
            <div class="help-text">Option strike price</div>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>
                Expiration Date <span class="required">*</span>
            </label>
            <input type="date" name="expiration" required>
            <div class="help-text">Option expiration (YYYY-MM-DD)</div>
        </div>

        <div class="form-group">
            <label>
                Option Type <span class="required">*</span>
            </label>
            <select name="option_type" required>
                <option value="PUT" selected>PUT</option>
                <option value="CALL">CALL</option>
            </select>
        </div>
    </div>

    <!-- Optional Pricing Fields -->
    <h3 style="margin: 30px 0 20px; color: #667eea; font-size: 18px;">Pricing Data <span class="optional">(optional)</span></h3>

    <div class="form-row">
        <div class="form-group">
            <label>Premium <span class="optional">(optional)</span></label>
            <input type="number" name="premium" step="0.01" min="0" placeholder="0.45">
            <div class="help-text">Expected premium per contract</div>
        </div>

        <div class="form-group">
            <label>Bid <span class="optional">(optional)</span></label>
            <input type="number" name="bid" step="0.01" min="0" placeholder="0.44">
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Ask <span class="optional">(optional)</span></label>
            <input type="number" name="ask" step="0.01" min="0" placeholder="0.46">
        </div>

        <div class="form-group">
            <label>Stock Price <span class="optional">(optional)</span></label>
            <input type="number" name="stock_price" step="0.01" min="0" placeholder="204.50">
            <div class="help-text">Current underlying price</div>
        </div>
    </div>

    <!-- Optional Greeks & Statistics -->
    <h3 style="margin: 30px 0 20px; color: #667eea; font-size: 18px;">Greeks & Statistics <span class="optional">(optional)</span></h3>

    <div class="form-row">
        <div class="form-group">
            <label>Delta <span class="optional">(optional)</span></label>
            <input type="number" name="delta" step="0.01" placeholder="-0.15">
            <div class="help-text">Option delta (e.g., -0.15)</div>
        </div>

        <div class="form-group">
            <label>OTM % <span class="optional">(optional)</span></label>
            <input type="number" name="otm_pct" step="0.01" min="0" placeholder="0.12">
            <div class="help-text">Out-of-money percentage (0.12 = 12%)</div>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>IV <span class="optional">(optional)</span></label>
            <input type="number" name="iv" step="0.01" min="0" max="10" placeholder="0.75">
            <div class="help-text">IV Last from IBKR (0.75 = 75%, 1.07 = 107%)</div>
        </div>

        <div class="form-group">
            <label>Trend <span class="optional">(optional)</span></label>
            <select name="trend">
                <option value="">-- Select --</option>
                <option value="uptrend">Uptrend</option>
                <option value="downtrend">Downtrend</option>
                <option value="sideways">Sideways</option>
            </select>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Volume <span class="optional">(optional)</span></label>
            <input type="number" name="volume" min="0" placeholder="450">
            <div class="help-text">Option volume</div>
        </div>

        <div class="form-group">
            <label>Open Interest <span class="optional">(optional)</span></label>
            <input type="number" name="open_interest" min="0" placeholder="1200">
        </div>
    </div>

    <!-- Notes -->
    <div class="form-group">
        <label>Notes <span class="optional">(optional)</span></label>
        <textarea name="notes" placeholder="Your reasoning for this trade... e.g., Strong uptrend, tested support at 200"></textarea>
        <div class="help-text">Your analysis and reasoning for this opportunity</div>
    </div>

    <!-- Submit Buttons -->
    <div class="btn-group">
        <button type="submit" name="action" value="save" class="btn btn-primary">
            ðŸ’¾ Save Trade
        </button>
        <button type="submit" name="action" value="add_another" class="btn btn-secondary">
            âž• Save & Add Another
        </button>
    </div>
</form>
{% endblock %}
